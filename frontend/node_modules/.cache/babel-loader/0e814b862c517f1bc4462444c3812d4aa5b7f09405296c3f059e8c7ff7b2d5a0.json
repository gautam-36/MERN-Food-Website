{"ast":null,"code":"import _regeneratorRuntime from\"C:/React/MERN FOOD/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/React/MERN FOOD/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React from\"react\";import{useSelector}from\"react-redux\";import CartProduct from\"../component/cartProduct\";import emptyCartImage from\"../assest/empty.gif\";import{toast}from\"react-hot-toast\";import{loadStripe}from\"@stripe/stripe-js\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var stripePromise=loadStripe(\"pk_test_51MpkaWSBDWHFiQ13fwpApR9ghYr5wuMFiypMZvGaasDvxOprBHN2oV8Npx8dLYlK0u4PRTvsf14bY23AR8s6gTgk00vfxFxsfj\");var Cart=function Cart(){var productCartItem=useSelector(function(state){return state.product.cartItem;});var user=useSelector(function(state){return state.user;});var navigate=useNavigate();var totalPrice=productCartItem.reduce(function(acc,curr){return acc+parseInt(curr.total);},0);var totalQty=productCartItem.reduce(function(acc,curr){return acc+parseInt(curr.qty);},0);var handlePayment=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var stripe,res,data,result;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!user.email){_context.next=27;break;}_context.prev=1;_context.next=4;return stripePromise;case 4:stripe=_context.sent;_context.next=7;return fetch(\"https://food-backend-mern.onrender.com/checkout\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({items:productCartItem.map(function(item){return{name:item.name,price:item.price,quantity:item.qty};})})});case 7:res=_context.sent;if(!(res.status===500)){_context.next=11;break;}toast.error(\"Server error. Please try again.\");return _context.abrupt(\"return\");case 11:_context.next=13;return res.json();case 13:data=_context.sent;toast(\"Redirecting to payment gateway...\");_context.next=17;return stripe.redirectToCheckout({sessionId:data.url});case 17:result=_context.sent;if(result.error){toast.error(result.error.message);}_context.next=25;break;case 21:_context.prev=21;_context.t0=_context[\"catch\"](1);toast.error(\"Payment failed. Please try again.\");console.error(\"Error:\",_context.t0);case 25:_context.next=29;break;case 27:toast(\"You are not logged in!\");setTimeout(function(){navigate(\"/login\");},1000);case 29:case\"end\":return _context.stop();}},_callee,null,[[1,21]]);}));return function handlePayment(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-2 md:p-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg md:text-2xl font-bold text-slate-600\",children:\"Your Cart Items\"}),productCartItem.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"my-4 flex gap-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-full max-w-3xl\",children:productCartItem.map(function(el){return/*#__PURE__*/_jsx(CartProduct,{id:el._id,name:el.name,image:el.image,category:el.category,qty:el.qty,total:el.total,price:el.price},el._id);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-md ml-auto\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"bg-blue-500 text-white p-2 text-lg\",children:\"Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex w-full py-2 text-lg border-b\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Total Qty :\"}),/*#__PURE__*/_jsx(\"p\",{className:\"ml-auto w-32 font-bold\",children:totalQty})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex w-full py-2 text-lg border-b\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Total Price\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"ml-auto w-32 font-bold\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500\",children:\"\\u20B9\"}),\" \",totalPrice]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"bg-red-500 w-full text-lg font-bold py-2 text-white\",onClick:handlePayment,children:\"Payment\"})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"flex w-full justify-center items-center flex-col\",children:[/*#__PURE__*/_jsx(\"img\",{src:emptyCartImage,className:\"w-full max-w-sm\",alt:\"Empty Cart\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-500 text-3xl font-bold\",children:\"Empty Cart\"})]})]})});};export default Cart;","map":{"version":3,"names":["React","useSelector","CartProduct","emptyCartImage","toast","loadStripe","useNavigate","stripePromise","Cart","productCartItem","state","product","cartItem","user","navigate","totalPrice","reduce","acc","curr","parseInt","total","totalQty","qty","handlePayment","email","stripe","fetch","method","headers","body","JSON","stringify","items","map","item","name","price","quantity","res","status","error","json","data","redirectToCheckout","sessionId","url","result","message","console","setTimeout","length","el","_id","image","category"],"sources":["C:/React/MERN FOOD/frontend/src/page/Cart.js"],"sourcesContent":["import React from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport CartProduct from \"../component/cartProduct\";\r\nimport emptyCartImage from \"../assest/empty.gif\";\r\nimport { toast } from \"react-hot-toast\";\r\nimport { loadStripe } from \"@stripe/stripe-js\";\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\nconst stripePromise = loadStripe(\"pk_test_51MpkaWSBDWHFiQ13fwpApR9ghYr5wuMFiypMZvGaasDvxOprBHN2oV8Npx8dLYlK0u4PRTvsf14bY23AR8s6gTgk00vfxFxsfj\");\r\n\r\nconst Cart = () => {\r\n  const productCartItem = useSelector((state) => state.product.cartItem);\r\n  const user = useSelector((state) => state.user);\r\n  const navigate = useNavigate();\r\n\r\n  const totalPrice = productCartItem.reduce(\r\n    (acc, curr) => acc + parseInt(curr.total),\r\n    0\r\n  );\r\n  const totalQty = productCartItem.reduce(\r\n    (acc, curr) => acc + parseInt(curr.qty),\r\n    0\r\n  );\r\n\r\n  const handlePayment = async () => {\r\n    if (user.email) {\r\n      try {\r\n        const stripe = await stripePromise;\r\n\r\n        const res = await fetch(\"https://food-backend-mern.onrender.com/checkout\", {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n          },\r\n          body: JSON.stringify({\r\n            items: productCartItem.map((item) => ({\r\n              name: item.name,\r\n              price: item.price,\r\n              quantity: item.qty,\r\n            })),\r\n          }),\r\n        });\r\n\r\n        if (res.status === 500) {\r\n          toast.error(\"Server error. Please try again.\");\r\n          return;\r\n        }\r\n\r\n        const data = await res.json();\r\n        toast(\"Redirecting to payment gateway...\");\r\n\r\n        const result = await stripe.redirectToCheckout({\r\n          sessionId: data.url,\r\n        });\r\n\r\n        if (result.error) {\r\n          toast.error(result.error.message);\r\n        }\r\n      } catch (error) {\r\n        toast.error(\"Payment failed. Please try again.\");\r\n        console.error(\"Error:\", error);\r\n      }\r\n    } else {\r\n      toast(\"You are not logged in!\");\r\n      setTimeout(() => {\r\n        navigate(\"/login\");\r\n      }, 1000);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"p-2 md:p-4\">\r\n        <h2 className=\"text-lg md:text-2xl font-bold text-slate-600\">\r\n          Your Cart Items\r\n        </h2>\r\n\r\n        {productCartItem.length > 0 ? (\r\n          <div className=\"my-4 flex gap-3\">\r\n            {/* display cart items */}\r\n            <div className=\"w-full max-w-3xl\">\r\n              {productCartItem.map((el) => (\r\n                <CartProduct\r\n                  key={el._id}\r\n                  id={el._id}\r\n                  name={el.name}\r\n                  image={el.image}\r\n                  category={el.category}\r\n                  qty={el.qty}\r\n                  total={el.total}\r\n                  price={el.price}\r\n                />\r\n              ))}\r\n            </div>\r\n\r\n            {/* total cart item */}\r\n            <div className=\"w-full max-w-md ml-auto\">\r\n              <h2 className=\"bg-blue-500 text-white p-2 text-lg\">Summary</h2>\r\n              <div className=\"flex w-full py-2 text-lg border-b\">\r\n                <p>Total Qty :</p>\r\n                <p className=\"ml-auto w-32 font-bold\">{totalQty}</p>\r\n              </div>\r\n              <div className=\"flex w-full py-2 text-lg border-b\">\r\n                <p>Total Price</p>\r\n                <p className=\"ml-auto w-32 font-bold\">\r\n                  <span className=\"text-red-500\">â‚¹</span> {totalPrice}\r\n                </p>\r\n              </div>\r\n              <button\r\n                className=\"bg-red-500 w-full text-lg font-bold py-2 text-white\"\r\n                onClick={handlePayment}\r\n              >\r\n                Payment\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex w-full justify-center items-center flex-col\">\r\n            <img src={emptyCartImage} className=\"w-full max-w-sm\" alt=\"Empty Cart\" />\r\n            <p className=\"text-slate-500 text-3xl font-bold\">Empty Cart</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Cart;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}